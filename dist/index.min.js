!function(){"use strict";var t,e=((t={})[t[1]="壹"]=1,t[t[2]="贰"]=2,t[t[3]="叁"]=3,t[t[4]="肆"]=4,t[t[5]="伍"]=5,t[t[6]="陆"]=6,t[t[7]="柒"]=7,t[t[8]="捌"]=8,t[t[9]="玖"]=9,t[t[10]="零"]=0,t["拾"]=10,t["佰"]=100,t["仟"]=1e3,t["万"]=1e4,t["亿"]=1e8,t),n={"拾":1,"佰":2,"仟":3,"万":4,"亿":5};function r(t){return"拾佰仟万亿".includes(t)}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=a(t);if(e){var i=a(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}function u(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}var p="加",v="减",k="左括号",d="右括号",y=function(){function t(e,n){f(this,t),this.kind=e,this.data=n||e}return l(t,[{key:"is",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.includes(this.kind)}}]),t}();function w(t){return"壹贰叁肆伍陆柒捌玖拾佰仟万亿零0123456789".includes(t)}var b=function(){function t(e){f(this,t),this.source=e,this.pos=0,this.max=this.source.length,this.tokens=[]}return l(t,[{key:"process",value:function(){for(;this.pos<this.max;){var t=this.source[this.pos];if(w(t))this.processDigit(t);else switch(t){case"加":case"+":this.pushToken(p);break;case"减":case"-":this.pushToken(v);break;case"乘":case"*":this.pushToken("乘");break;case"除":case"/":this.pushToken("除");break;case"(":this.pushToken(k);break;case")":this.pushToken(d);break;case"左":case"右":this.processParen(t);break;case" ":case"\t":case"\r":case"\n":this.pos++;break;default:throw new Error("非法字符 ".concat(t))}}return this.tokens}},{key:"processDigit",value:function(t){for(var e=t;this.pos<this.max&&w(t=this.source[++this.pos]);)e+=t;this.tokens.push(new y(0,e))}},{key:"processParen",value:function(t){if(this.pos+2>=this.max)throw new Error("【".concat(t,"括号】错误长度"));var e=this.source[this.pos+1],n=this.source[this.pos+2];if("括"!==e)throw new Error("非法单词 ".concat(t+e));if("号"!==n)throw new Error("非法单词 ".concat(t+e+n));this.tokens.push(new y("左"===t?k:d)),this.pos+=3}},{key:"pushToken",value:function(t,e){this.tokens.push(new y(t,e)),this.pos++}}]),t}(),T=function t(e){f(this,t),this.type=e},m=function(t){o(n,t);var e=c(n);function n(t){var r;return f(this,n),(r=e.call(this,2)).token=t,r.value=t.data,r}return n}(T),E=function(t){o(n,t);var e=c(n);function n(t,r,i){var o;if(f(this,n),o=e.call(this,0),!t)throw new Error("".concat(r.data," 左边不能为空"));if(!i)throw new Error("".concat(r.data," 右边不能为空"));return o.left=t,o.op=r.kind,o.right=i,o}return n}(T),g=function(t){o(n,t);var e=c(n);function n(t,r){var i;if(f(this,n),i=e.call(this,1),!r)throw new Error("".concat(t.data," 后面不能为空"));return i.op=t.kind,i.child=r,i}return n}(T),x=function(){function t(e){f(this,t),this.tokenizer=e,this.pos=0}return l(t,[{key:"parse",value:function(){this.tokens=this.tokenizer.process(),this.nextToken();var t=this.eatExpr();if(this.nextToken(),this.currentToken)throw new Error("解析后还存在 ".concat(this.currentToken.data));return t}},{key:"nextToken",value:function(){this.currentToken=this.tokens[this.pos++]}},{key:"eatExpr",value:function(){for(var t=this.eatTerm();this.currentToken&&this.currentToken.is(p,v);){var e=this.currentToken;this.nextToken(),t=new E(t,e,this.eatTerm())}return t}},{key:"eatTerm",value:function(){for(var t=this.eatFactor();this.currentToken&&this.currentToken.is("乘","除");){var e=this.currentToken;this.nextToken(),t=new E(t,e,this.eatFactor())}return t}},{key:"eatFactor",value:function(){var t=this.currentToken;if(!t)return null;if(this.nextToken(),t.is(0))return new m(t);if(t.is(k)){var e=this.eatExpr();if(!this.currentToken||!this.currentToken.is(d))throw new Error("缺少右括号");return this.nextToken(),e}if(t.is(p,v))return new g(t,this.eatFactor());throw new Error("不期望的单词 【".concat(t.data,"】"))}}]),t}(),S=function(){function t(e){f(this,t),this.parser=e}return l(t,[{key:"interpret",value:function(){var t=this.parser.parse();return t?this.visit(t):""}},{key:"visit",value:function(t){if(!t)throw new Error("节点未空");switch(t.type){case 0:return this.visitBinOp(t);case 1:return this.visitUnaryOp(t);case 2:return this.visitNum(t);default:throw new Error("未知节点 ".concat(t))}}},{key:"visitNum",value:function(t){return function(t){if(!isNaN(Number(t)))return Number(t);var n=t.replace(/^零*/,""),i=n[0];if(!i)return 0;if("佰仟万亿".includes(i))return e[i];if("拾"===i)return 10+(e[n[1]]||0);for(var o=function(t){for(var i=1;t;){if(!r(t))return i;i*=e[t],t=n[++c]}return i},s=[e[i]],c=1,u=n[c];u;)r(u)?(s.push(s.pop()*o(u)),u=n[c]):(s.push(e[u]),u=n[++c]);var a="",f=!1,h=!1;return s.forEach((function(t){if(f&&0===t)h=!0;else{if(f)if(a=parseInt(a,10),h||t>=10)a+=t;else{var e=String(a),n=e.replace(/0(?=0*$)/,t);a=e===n?e+t:n}else a+=t;t>=10&&(f=!0)}})),parseInt(a,10)}(t.value)}},{key:"visitBinOp",value:function(t){var e=this.visit(t.left),n=this.visit(t.right);return t.op===p?e+n:t.op===v?e-n:"乘"===t.op?e*n:"除"===t.op?Math.round(e/n):void 0}},{key:"visitUnaryOp",value:function(t){return t.op===p?this.visit(t.child):t.op===v?-this.visit(t.child):void 0}}]),t}();window.onload=function(){var t=document.querySelector("#nums"),i=document.querySelector("#units"),o=document.querySelector("#ops"),s=document.querySelector("#inp"),c=document.querySelector("#equal"),u=document.querySelector("#clear"),a=document.querySelector("#records"),f=null,h="",l="",p="";function v(){if(s.value){var t=document.createElement("div");t.classList.add("record"),t.innerHTML='\n      <div class="flex-center">\n        <div class="record_time">'.concat((new Date).toLocaleString(),"</div>\n        <div>").concat(s.value,'</div>\n      </div>\n      <div class="record_ans">').concat((i=s.value,function(t){if(0===t)return"零";if(isNaN(t))return"不是数字";if(!isFinite(t))return"无限";if(t=Math.round(t),isNaN(t)||!t)return"不是数字";var i=!1;t<0&&(i=!0,t*=-1);var o=function t(n){var r=!1;n.startsWith("0")&&(r=!0,n=n.replace(/^0+/,""));var i=n.length;if(!i)return"";var o=r?"零":"",s=0,c="";if(i>8)s=i-8,c="亿";else if(i>4)s=i-4,c="万";else if(i>3)s=i-3,c="仟";else if(i>2)s=i-2,c="佰";else{if(!(i>1))return o+e[n];s=i-1,c="拾"}return o+t(n.slice(0,s))+c+t(n.slice(s))}(String(t));"壹"===o[0]&"拾"===o[1]&&(o=o.slice(1));var s=o.length;return r(o[s-1])&&r(o[s-3])&&n[o[s-3]]-n[o[s-1]]==1&&(o=o.slice(0,-1)),(i?"负":"")+o}(new S(new x(new b(i))).interpret())),"</div>\n    "),a.insertBefore(t,f),f=t,s.value="",s.focus()}var i}"零壹贰叁肆伍陆柒捌玖".split("").forEach((function(t){h+='<div class="btn" data-ch="'.concat(t,'">').concat(t,"</div>")})),"拾佰仟万亿".split("").forEach((function(t){l+='<div class="btn" data-ch="'.concat(t,'">').concat(t,"</div>")})),["加","减","乘","除","左括号","右括号"].forEach((function(t){p+='<div class="btn" data-ch="'.concat(t,'">').concat(t,"</div>")})),t.innerHTML=h,i.innerHTML=l,o.innerHTML=p,t.onclick=i.onclick=o.onclick=function(t){var e=t.target.dataset.ch;e&&(s.value+=e,s.focus())},u.onclick=function(){s.value="",s.focus()},s.onkeydown=function(t){13==(t.keyCode||t.which)&&v()},c.onclick=v}}();